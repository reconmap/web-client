import { requestVulnerabilities } from "api/requests/vulnerabilities.js";
import VulnerabilityTableModel from "components/vulnerabilities/VulnerabilityTableModel";
import { useEffect, useState } from "react";
import VulnerabilitiesTable from "../vulnerabilities/VulnerabilitiesTable";

const VulnerabilityTemplatesSearchResults = ({ keywords, emptyResultsSetter: setEmptyResults }) => {
    const [tableModel, setTableModel] = useState(new VulnerabilityTableModel());

    useEffect(() => {
        const reloadData = () => {
            requestVulnerabilities({ isTemplate: 1, keywords }).then((vulnerabilityTemplates) => {
                setTableModel((tableModel) => ({ ...tableModel, vulnerabilities: vulnerabilityTemplates.data }));
                setEmptyResults((emptyResults) =>
                    0 === vulnerabilityTemplates.data.length
                        ? emptyResults.concat("vulnerability_templates")
                        : emptyResults.filter((value) => value !== "vulnerability_templates"),
                );
            });
        };

        reloadData();
    }, [keywords, setTableModel, setEmptyResults]);

    if (tableModel.vulnerabilities.length === 0) return <></>;

    return (
        <>
            <h3>{tableModel.vulnerabilities.length} matching vulnerability templates</h3>
            <VulnerabilitiesTable tableModel={tableModel} tableModelSetter={setTableModel} showSelection={false} />
        </>
    );
};

export default VulnerabilityTemplatesSearchResults;
