import PrimaryButton from "components/ui/buttons/Primary.jsx";
import CssIcon from "components/ui/CssIcon.jsx";
import EmptyField from "components/ui/EmptyField";
import { actionCompletedToast } from "components/ui/toast.jsx";
import ReactMarkdown from "react-markdown";
import secureApiFetch from "services/api.js";

const VulnerabilityRemediationPanel = ({ vulnerability }) => {
    const generateRemediation = () => {
        secureApiFetch(`/vulnerabilities/${vulnerability.id}/remediation`, { method: "PUT" });
        actionCompletedToast("AI job queued. Please come back here later");
    };

    return (
        <>
            {!vulnerability.remediation && (
                <>
                    <PrimaryButton onClick={generateRemediation}>
                        <CssIcon name="brain" />
                        &nbsp; Generate remediation instructions with AI
                    </PrimaryButton>
                    <hr />
                </>
            )}
            <div className="grid grid-two">
                <div className="content">
                    <h4>Remediation instructions</h4>
                    {vulnerability.remediation ? (
                        <ReactMarkdown>{vulnerability.remediation}</ReactMarkdown>
                    ) : (
                        <EmptyField />
                    )}
                </div>

                <div>
                    <h4>Properties</h4>
                    <dl>
                        <dt>Priority</dt>
                        <dd>{vulnerability.remediation_priority ?? <EmptyField />}</dd>

                        <dt>Complexity</dt>
                        <dd>{vulnerability.remediation_complexity ?? <EmptyField />}</dd>
                    </dl>
                </div>
            </div>
        </>
    );
};

export default VulnerabilityRemediationPanel;
